**Задание на отправку сообщений через EventSender

Этот скрипт предназначен для отправки сообщений через мессенджер в соответствии с расписанием, заданным в базе данных. Скрипт периодически проверяет задания на отправку и выполняет их, если текущее время совпадает с временем отправки, указанным в базе.

Описание работы
Скрипт проверяет базу данных: Получает все задания, которые должны быть отправлены.
Сравнение времени: Для каждого задания проверяется, совпадает ли время с текущей минутой, часом, днем, месяцем и днем недели.
Отправка сообщения: Если время задания совпадает с текущим временем, скрипт отправляет сообщение через мессенджер, используя класс EventSender.
Регулярный запуск: Скрипт настроен на выполнение каждую минуту с помощью cron.
Структура проекта

/path/to/your/project
├── script.php               # Основной скрипт, который проверяет задания и отправляет сообщения
└── vendor/                  # Папка с зависимостями (если используете Composer)
Установка
Скачайте или клонируйте проект: Если проект еще не скачан, вы можете скачать его или клонировать с помощью Git.

Установите зависимости (если используете Composer): В директории проекта выполните команду:

composer install
Настройте подключение к базе данных: Убедитесь, что ваш скрипт подключается к базе данных. В скрипте указаны данные для подключения (пользователь, пароль, база данных).

Настройте crontab для регулярного выполнения скрипта: Для того чтобы скрипт выполнялся каждую минуту, настройте задачу cron:

Откройте crontab для редактирования:

crontab -e
Добавьте строку:


* * * * * /usr/bin/php /path/to/your/script.php
Убедитесь, что путь к PHP и путь к скрипту указаны правильно.

Проверьте, что crontab работает: После настройки crontab, чтобы убедиться, что задача добавлена, выполните:

crontab -l
Эта команда покажет все текущие задачи cron.

Как это работает
Скрипт запускается каждую минуту благодаря настройкам cron.
Внутри скрипта происходит подключение к базе данных, из которой извлекаются все задачи на отправку сообщений.
Для каждой задачи проверяется, совпадает ли текущее время с временем отправки, указанным в базе данных.
Если время совпало, отправляется сообщение через класс EventSender.
В случае успешной отправки сообщения выводится лог с датой, временем и содержанием сообщения.
Пример логирования отправки сообщения
Если задание совпадает с текущим временем, в лог выводится сообщение:

23.02.25 12:34 Я отправил сообщение "Напоминание о встрече" получателю с id 123
Структура базы данных
Для корректной работы скрипта предполагается, что в базе данных существует таблица tasks с заданиями на отправку сообщений. Пример структуры таблицы:


CREATE TABLE tasks (
    id INT AUTO_INCREMENT PRIMARY KEY,
    receiver_id INT NOT NULL,
    message TEXT NOT NULL,
    scheduled_time DATETIME NOT NULL,
    status ENUM('pending', 'sent') DEFAULT 'pending'
);
Зависимости
PHP 7.4 или выше
База данных (MySQL, PostgreSQL или другая, в зависимости от вашего проекта)
Composer (для установки зависимостей)
Логи
Если вы хотите, чтобы лог выполнения скрипта записывался в файл, добавьте вывод в файл в команду crontab:

* * * * * /usr/bin/php /path/to/your/script.php >> /path/to/logfile.log 2>&1